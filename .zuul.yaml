---
- project:
    templates:
      - build-openstack-docs-pti
    check:
      jobs:
        - stx-devstack-fault:
            voting: false
        - build-openstack-api-ref
        - build-openstack-releasenotes
        - openstack-tox-linters
        - openstack-tox-pep8
    gate:
      jobs:
        - build-openstack-api-ref
        - build-openstack-releasenotes
        - openstack-tox-linters
        - openstack-tox-pep8
    post:
      jobs:
        - publish-stx-tox

# This job is to begin testing a DevStack run here
- job:
    name: stx-devstack-base
    parent: devstack
    description: |
      Base job for StarlingX DevStack tests
    roles:
      - zuul: openstack-infra/devstack
    timeout: 9000
    irrelevant-files:
      - ^.*\.rst$
      - ^doc/.*$
      - ^releasenotes/.*$
    vars:
      devstack_plugins:
        stx-fault: git://git.starlingx.io/stx-fault
      devstack_services:
        ceilometer-acentral: false
        ceilometer-acompute: false
        ceilometer-alarm-evaluator: false
        ceilometer-alarm-notifier: false
        ceilometer-anotification: false
        ceilometer-api: false
        ceilometer-collector: false
        # Cinder services
        #c-api: false
        #c-bak: false
        #c-sch: false
        #c-vol: false
        #cinder: false
        # Glance services
        #g-api: false
        #g-reg: false
        # Nova services
        n-api: false
        n-api-meta: false
        n-cauth: false
        n-cond: false
        n-cpu: false
        n-novnc: false
        n-obj: false
        n-sch: false
        placement-api: false
        # Neutron services
        # We need to keep using the neutron-legacy based services for
        # now until all issues with the new lib/neutron code are solved
        #q-agt: false
        #q-dhcp: false
        #q-l3: false
        #q-meta: false
        #q-metering: false
        #q-svc: false
        # neutron-api: false
        # neutron-agent: false
        # neutron-dhcp: false
        # neutron-l3: false
        # neutron-metadata-agent: false
        # neutron-metering: false
        horizon: false
        # Swift services
        s-account: false
        s-container: false
        s-object: false
        s-proxy: false
        tempest: false

- job:
    name: stx-devstack-fault
    parent: stx-devstack-base
    timeout: 7800
    vars:
      tox_envlist: functional
